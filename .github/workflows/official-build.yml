name: Build TalkBack via Official Partner Script

on:
  workflow_dispatch:

jobs:
  build-talkback:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. 准备 Java 17 环境
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          # 这会自动设置环境变量 JAVA_HOME

      # 2. 修改包名
      - name: Customize Package Name
        run: |
          find . -name "build.gradle" -exec sed -i 's/com.google.android.marvin.talkback/com.mycustom.talkback/g' {} +
          echo "包名已修改为 com.mycustom.talkback"

      # 3. 运行官方 build.sh 脚本
      - name: Execute build.sh
        run: |
          # 赋予脚本执行权限
          chmod +x ./build.sh
          
          # 手动导出脚本需要的变量
          # 在 GitHub Runner 中，$ANDROID_HOME 是预设的 SDK 路径
          export ANDROID_SDK=$ANDROID_HOME
          
          # 打印一下路径确保不为空（调试用）
          echo "Using Android SDK at: $ANDROID_SDK"
          echo "Using Java Home at: $JAVA_HOME"
          
          # 运行脚本
          ./build.sh
